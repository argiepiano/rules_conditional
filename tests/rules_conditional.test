<?php
/**
 * @file
 * SimpleTest testing suites.
 */

/**
 * Framework tests.
 */
class RulesConditionalFrameworkTestCase extends DrupalWebTestCase {
  /**
   * Returns test info.
   */
  public static function getInfo() {
    return array(
      'name' => 'Framework',
      'description' => 'Test the core conditional plugin framework.',
      'group' => 'Conditional Rules',
    );
  }

  /**
   * Sets up test case.
   */
  protected function setUp() {
    parent::setUp('rules_conditional_test');
  }

  /**
   * Tests plugin label.
   */
  public function testPluginLabel() {
    $conditional = new RulesConditionalTestStubContainer();
    $label = $conditional->label();
    $this->assertEqual('Stub conditional', $label, 'Default conditional element label uses the plugin label.');

    $branch = new RulesConditionalTestStubElement();
    $label = $branch->label();
    $this->assertEqual('Stub conditional branch', $label, 'Default conditional branch element label uses the plugin label.');
  }

  /**
   * Tests intercepting a method.
   */
  public function testInterceptMethod() {
    $message = 'Test magic method is intercepted.';
    try {
      $conditional = new RulesConditionalTestStubContainer();
      $conditional->test();
      $this->assert(FALSE, $message);
    }
    catch (Exception $ex) {
      $this->assertEqual('intercept', $ex->getMessage(), $message);
    }
  }

  /**
   * Tests fluent interface.
   */
  public function testFluentInterface() {
    $conditional = new RulesConditionalTestStubContainer();
    $container1 = new RulesActionSet();
    $conditional->fluent($container1)->action('drupal_message', array('message' => '[site:name]'));
    $this->assertEqual(1, count($container1->elements()), 'Fluent interface adds action to the active element.');
    $container2 = new RulesActionSet();
    $conditional->fluent($container2)->action('drupal_message', array('message' => '[site:name]'));
    $this->assertEqual(1, count($container1->elements()), 'Fluent interface does not add action to a previously active element.');
  }

  /**
   * Tests branch sibling methods.
   */
  public function testBranchSibling() {
    // Set up stub objects.
    $conditional = new RulesConditionalTestStubContainer();
    $branch1 = new RulesConditionalTestStubElement();
    $branch1->setParent($conditional);
    $branch2 = new RulesConditionalTestStubElement();
    $branch2->setParent($conditional);
    $orphanBranch = new RulesConditionalTestStubElement();

    // Test obtaining siblings.
    $this->assertIdentical($branch2, $branch1->getNextSibling(), 'Next sibling branch can be obtained.');
    $this->assertIdentical($branch1, $branch2->getPreviousSibling(), 'Previous sibling branch can be obtained.');
    $this->assertNull($branch1->getPreviousSibling(), 'First branch has no previous sibling.');
    $this->assertNull($branch2->getNextSibling(), 'Last branch has no next sibling.');

    // Test obtaining siblings from an orphan element.
    $this->assertNull($orphanBranch->getNextSibling(), 'Orphan branch has no next sibling.');
    $this->assertNull($orphanBranch->getPreviousSibling(), 'Orphan branch has no previous sibling.');
  }
}

/**
 * Default if-else tests.
 */
class RulesConditionalTestCase extends DrupalWebTestCase {
  /**
   * Returns test info.
   */
  public static function getInfo() {
    return array(
      'name' => 'Default conditional',
      'description' => 'Test the if-else plugins.',
      'group' => 'Conditional Rules',
    );
  }

  /**
   * Tests integrity check.
   */
  public function testIntegrityCheck() {
    // TODO
  }

  /**
   * Tests evaluation.
   */
  public function testEvaluate() {
    // TODO
  }

  /**
   * Tests exporting.
   */
  public function testExport() {
    // TODO
  }

  /**
   * Tests exporting.
   */
  public function testImport() {
    // TODO
  }
}

/**
 * Switch tests.
 */
class RulesConditionalSwitchTestCase extends DrupalWebTestCase {
  /**
   * Returns test info.
   */
  public static function getInfo() {
    return array(
      'name' => 'Switch',
      'description' => 'Test the switch plugins.',
      'group' => 'Conditional Rules',
    );
  }

  /**
   * Tests integrity check.
   */
  public function testIntegrityCheck() {
    // TODO
  }

  /**
   * Tests evaluation.
   */
  public function testEvaluate() {
    // TODO
  }

  /**
   * Tests exporting.
   */
  public function testExport() {
    // TODO
  }

  /**
   * Tests exporting.
   */
  public function testImport() {
    // TODO
  }
}

/**
 * UI tests.
 */
class RulesConditionalUITestCase extends DrupalWebTestCase {
  /**
   * Returns test info.
   */
  public static function getInfo() {
    return array(
      'name' => 'User interface',
      'description' => 'Test the user interface implementations for conditional plugins.',
      'group' => 'Conditional Rules',
    );
  }

  /**
   * Sets up test case.
   */
  protected function setUp() {
    parent::setUp('rules_conditional_test', 'rules_admin');
  }

  /**
   * Tests RulesConditionalPluginUI.
   */
  public function testBaseUI() {
    // TODO
  }

  /**
   * Tests RulesConditionalEmptyUI.
   */
  public function testEmptyUI() {
    // TODO
  }

  /**
   * Tests RulesConditionalPredicateUI.
   */
  public function testPredicateUI() {
    // TODO
  }

  /**
   * Tests RulesConditionalCaseUI.
   */
  public function testCaseUI() {
    // TODO
  }
}
